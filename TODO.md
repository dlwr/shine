# SHINE TODO リスト

このファイルは、2025年6月23日にコードベース分析で発見された改善点をまとめたものです。

## 🔴 優先度：高（緊急対応必要）

### 1. APIファイルの分割
- **問題**: `api/src/index.ts`が1000行超の巨大ファイル
- **対策**: 機能別にルートファイルを分割
  - `api/src/routes/movies.ts`
  - `api/src/routes/auth.ts`
  - `api/src/routes/admin.ts`
  - `api/src/routes/selections.ts`
- **影響**: 保守性、可読性、開発効率の大幅改善

### 2. リクエストバリデーション実装
- **問題**: API入力検証が未実装、不正データによる脆弱性
- **対策**: Zod/Valibotを使用したスキーマバリデーション
- **実装箇所**: 全APIエンドポイントの入力検証ミドルウェア
- **影響**: データ整合性、セキュリティ向上

### 3. データベースインデックス追加
- **問題**: 頻繁にクエリされるカラムにインデックスなし
- **対策**: 以下カラムにインデックス追加
  - `movies.year`
  - `movies.originalLanguage`
  - `movies.createdAt`
  - `translations.resourceType + resourceUid + languageCode`
- **影響**: クエリパフォーマンス大幅向上

### 4. エラーハンドリング改善
- **問題**: 統一的なエラー処理が欠如
- **対策**: 
  - エラーレスポンス形式の統一
  - エラーハンドリングミドルウェア実装
  - 適切なHTTPステータスコード使用
- **影響**: デバッグ効率、ユーザー体験向上

### 5. セキュリティ脆弱性修正
- **問題**: 複数のセキュリティ課題
- **対策**:
  - CORS設定の適切な制限（現在は `*` で全許可）
  - 入力サニタイゼーション実装
  - XSS対策（フロントエンドでのエスケープ処理）
  - SQL インジェクション対策強化
  - 2FA認証システム検討
- **影響**: システムセキュリティ強化

## 🟡 優先度：中（計画的実装）

### 6. API検索機能追加
- **問題**: 映画タイトル検索やフィルタリング機能なし
- **対策**:
  - 全文検索機能実装
  - 年代、言語、受賞歴でのフィルタリング
  - ページネーション改善（総件数、ページ情報付与）
- **影響**: ユーザビリティ大幅向上

### 7. キャッシュレイヤー実装
- **問題**: APIレスポンスキャッシュなし、DB負荷高
- **対策**:
  - Redis/メモリキャッシュ導入
  - ETags実装
  - キャッシュ無効化戦略策定
- **影響**: レスポンス速度向上、インフラコスト削減

### 8. フロントエンドローディング状態
- **問題**: データ取得中の視覚的フィードバックなし
- **対策**:
  - スケルトンローダー実装
  - ローディングスピナー追加
  - エラーバウンダリ実装
- **影響**: ユーザー体験向上

### 9. APIドキュメント作成
- **問題**: API仕様書が存在しない
- **対策**:
  - OpenAPI/Swagger仕様書作成
  - 自動生成パイプライン構築
  - インタラクティブドキュメント提供
- **影響**: 開発効率、API理解促進

### 10. テストカバレッジ向上
- **問題**: 統合テスト不足、エラーケーステスト欠如
- **対策**:
  - APIエンドポイント統合テスト追加
  - E2Eテスト実装
  - パフォーマンステスト導入
- **影響**: コード品質、リグレッション防止

## 🟢 優先度：低（将来的改善）

### アーキテクチャ改善
- **サービス層の実装**: ビジネスロジックとAPI層の分離
- **リポジトリパターン**: データアクセス層の抽象化
- **API バージョニング**: `/v1/` プレフィックス導入

### 監視・運用改善
- **APM導入**: アプリケーションパフォーマンス監視
- **エラートラッキング**: Sentry等の導入
- **ログ集約**: 構造化ログとログ分析

### 機能拡張
- **Webhook システム**: 外部システム連携
- **バルク操作API**: 一括更新機能
- **オフラインサポート**: Service Worker実装

---

## 実装順序の推奨

1. **セキュリティ脆弱性修正** → システム安全性確保
2. **APIファイル分割** → 開発効率向上
3. **データベースインデックス** → パフォーマンス改善
4. **リクエストバリデーション** → データ品質向上
5. **エラーハンドリング改善** → 運用安定性向上

その後、中優先度項目を順次実装していく。

**最終更新**: 2025年6月23日