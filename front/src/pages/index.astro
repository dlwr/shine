---
import Movies from "../components/Movies.astro";
import Layout from "../layouts/Layout.astro";
import LanguageSelector from "../components/LanguageSelector.astro";
import AdminLogin from "../components/AdminLogin.astro";

function getLocaleFromRequest(request: Request): string {
  const url = new URL(request.url);
  const localeParam = url.searchParams.get('locale');
  if (localeParam && ['en', 'ja'].includes(localeParam)) {
    return localeParam;
  }

  const acceptLanguage = request.headers.get('accept-language');
  if (acceptLanguage) {
    const languages = acceptLanguage
      .split(',')
      .map(lang => lang.trim().split(';')[0].split('-')[0])
      .filter(lang => ['en', 'ja'].includes(lang));
    
    if (languages.length > 0) {
      return languages[0];
    }
  }

  return 'en';
}

const locale = getLocaleFromRequest(Astro.request);
---

<Layout>
  <AdminLogin locale={locale} />
  <main class="py-8">
    <h1 class="text-center mb-4 text-5xl text-gray-900 font-bold">SHINE</h1>
    <LanguageSelector locale={locale} />
    <Movies locale={locale} />
  </main>
</Layout>
