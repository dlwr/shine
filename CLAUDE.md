# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

SHINE is a comprehensive movie database project designed to be the world's most organized movie database. It collects and organizes movie information, awards, nominations, and multilingual translations. The project is built on Cloudflare Workers with Turso (libSQL) database and uses a modular architecture with separate packages for API, scrapers, database, and frontend.

## Architecture

The project uses a simplified monorepo structure with pnpm workspaces:

- **api/** - Hono-based REST API running on Cloudflare Workers
- **scrapers/** - Data collection tools (Wikipedia, IMDb planned) 
- **front/** - Astro-based frontend (Cloudflare Pages)
- **src/** - Shared database schemas, migrations, and utilities

Key design patterns:
- Date-seeded movie selection (daily/weekly/monthly) with deterministic hash-based randomization
- Multilingual support through a flexible translations table
- Comprehensive awards and nominations tracking system
- UUID-based primary keys with snake_case database naming
- Database: Turso (libSQL) - a SQLite-compatible edge database

## Common Commands

### Development
```bash
# Start API development server with local DB persistence
pnpm run api:dev

# Start frontend development server  
pnpm run front:dev

# Start scrapers development server
pnpm run scrapers:dev
```

### Database Operations
```bash
# Open database studio
pnpm run db:studio

# Generate migrations
pnpm run db:generate

# Apply migrations
pnpm run db:migrate

# Push schema changes
pnpm run db:push
```

### Deployment
```bash
# Deploy API to Cloudflare Workers
pnpm run api:deploy

# Deploy frontend to Cloudflare Pages
pnpm run front:deploy

# Deploy scrapers to Cloudflare Workers
pnpm run scrapers:deploy
```

### Utilities
```bash
# Lint code
npx eslint .

# Format code  
npx prettier --write .
```

## Database Schema

The core entities follow this relationship structure:

```
movies ←→ translations (movie titles/descriptions)
  ↓ 1:N
nominations → award_categories → award_organizations
  ↓ N:1           ↓ N:1
award_ceremonies ←
```

Important schema details:
- All tables use UUID primary keys generated by `generateUUID()` utility
- `translations` table supports any resource type with flexible content storage
- Database uses snake_case naming convention (configured in drizzle.config.ts)
- Date-seeded movie selection uses deterministic hash-based algorithms

## Database Configuration

The project uses Turso (libSQL) as the database. Configuration requires:
- `TURSO_DATABASE_URL`: Your Turso database URL (e.g., `libsql://your-database.turso.io`)
- `TURSO_AUTH_TOKEN`: Your Turso authentication token

For local development with Cloudflare Workers:
1. Copy `.env.example` to `.env` in the root directory
2. Add your Turso credentials to the `.env` file

Environment variables are loaded automatically by wrangler during development.

## Data Collection Strategy

Scrapers follow this priority order:
1. Wikipedia (primary source for basic info and awards)
2. IMDb (planned for detailed information)  
3. Other sources (future expansion)

Scraping uses Cheerio for HTML parsing with error handling, retry logic, and incremental updates to avoid duplicate data.

## API Design

The main API endpoint (`/`) returns date-seeded movie selections:
- Daily: Changes every day
- Weekly: Changes every Friday (week starts Friday)
- Monthly: Changes every month

Each selection uses hash-based seeding to ensure deterministic but varied results across different time periods.

## Code Style and Conventions

- TypeScript with strict configuration
- ESLint with recommended + strict + unicorn rules
- Prettier for formatting with import organization
- No comments in code unless explicitly requested
- Follow existing patterns for database queries and API responses
- Use existing utilities and libraries (Hono, Drizzle, Cheerio)

## Important Files

- `db/schema/index.ts` - Database schema definitions
- `api/src/index.ts` - Main API implementation with date-seeding logic
- `drizzle.config.ts` - Database configuration for Turso
- `.cursor/rules/shine.mdc` - Comprehensive project documentation and requirements
- `.env.example` / `.dev.vars.example` - Environment variable templates
- `.dev.vars` - Local development variables (symlinked to `api/` and `scrapers/`)