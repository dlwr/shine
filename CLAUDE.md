# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

SHINE is a comprehensive movie database project designed to be the world's most organized movie database. It collects and organizes movie information, awards, nominations, and multilingual translations. The project is built on Cloudflare Workers with Turso (libSQL) database and uses a modular architecture with separate packages for API, scrapers, database, and frontend.

## Architecture

The project uses a simplified monorepo structure with pnpm workspaces:

- **api/** - Hono-based REST API running on Cloudflare Workers
- **scrapers/** - CLI-based data collection tools (Wikipedia, IMDb planned) 
- **front/** - Astro-based frontend (Cloudflare Pages)
- **src/** - Shared database schemas, migrations, and utilities

Key design patterns:
- Date-seeded movie selection (daily/weekly/monthly) with deterministic hash-based randomization
- Multilingual support through a flexible translations table
- Comprehensive awards and nominations tracking system
- UUID-based primary keys with snake_case database naming
- Database: Turso (libSQL) - a SQLite-compatible edge database

## Common Commands

### Development
```bash
# Start API development server with local DB persistence
pnpm run api:dev

# Start frontend development server  
pnpm run front:dev

# Run scrapers (CLI tools)
pnpm run scrapers:academy-awards
```

### Database Operations
```bash
# Open database studio
pnpm run db:studio

# Generate migrations
pnpm run db:generate

# Apply migrations
pnpm run db:migrate

# Push schema changes
pnpm run db:push
```

### Deployment
```bash
# Deploy API to development environment
pnpm run api:deploy:dev

# Deploy API to production environment
pnpm run api:deploy:prod

# Deploy frontend to Cloudflare Pages
pnpm run front:deploy

# Note: Scrapers run locally as CLI tools and are not deployed
```

### Utilities
```bash
# Lint code
npx eslint .

# Format code  
npx prettier --write .
```

## Database Schema

The core entities follow this relationship structure:

```
movies ←→ translations (movie titles/descriptions)
  ↓ 1:N
nominations → award_categories → award_organizations
  ↓ N:1           ↓ N:1
award_ceremonies ←
```

Important schema details:
- All tables use UUID primary keys generated by `generateUUID()` utility
- `translations` table supports any resource type with flexible content storage
- Database uses snake_case naming convention (configured in drizzle.config.ts)
- Date-seeded movie selection uses deterministic hash-based algorithms

## Database Configuration

The project uses Turso (libSQL) as the database with separate databases for development and production. Configuration requires:

**Development Environment:**
- `TURSO_DATABASE_URL_DEV`: Your development Turso database URL
- `TURSO_AUTH_TOKEN_DEV`: Your development Turso authentication token

**Production Environment:**
- `TURSO_DATABASE_URL_PROD`: Your production Turso database URL  
- `TURSO_AUTH_TOKEN_PROD`: Your production Turso authentication token

For local development with Cloudflare Workers:
1. Copy `.env.example` to `.env` in the root directory
2. Add your Turso credentials for both development and production environments
3. Environment variables are loaded automatically by wrangler during development

For production deployment, set secrets using:
```bash
wrangler secret put TURSO_AUTH_TOKEN_PROD --env production
```

## Data Collection Strategy

Scrapers are CLI-based tools that run locally and follow this priority order:
1. Wikipedia (primary source for basic info and awards)
2. IMDb (planned for detailed information)  
3. Other sources (future expansion)

Scraping uses Cheerio for HTML parsing with error handling, retry logic, and incremental updates to avoid duplicate data. Run scrapers manually when data updates are needed.

## API Design

The main API endpoint (`/`) returns date-seeded movie selections:
- Daily: Changes every day
- Weekly: Changes every Friday (week starts Friday)
- Monthly: Changes every month

Each selection uses hash-based seeding to ensure deterministic but varied results across different time periods.

## Code Style and Conventions

- TypeScript with strict configuration
- ESLint with recommended + strict + unicorn rules
- Prettier for formatting with import organization
- No comments in code unless explicitly requested
- Follow existing patterns for database queries and API responses
- Use existing utilities and libraries (Hono, Drizzle, Cheerio)

## Important Files

- `db/schema/index.ts` - Database schema definitions
- `api/src/index.ts` - Main API implementation with date-seeding logic
- `drizzle.config.ts` - Database configuration for Turso
- `.cursor/rules/shine.mdc` - Comprehensive project documentation and requirements
- `.env.example` / `.dev.vars.example` - Environment variable templates
- `.dev.vars` - Local development variables (symlinked to `api/` and `scrapers/`)